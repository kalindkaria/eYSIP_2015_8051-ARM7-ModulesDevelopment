C51 COMPILER V9.01   VELOCITY_CONTROL                                                      06/11/2015 12:59:22 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE VELOCITY_CONTROL
OBJECT MODULE PLACED IN velocity_control.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE velocity_control.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*
   2          * Author: Bhumika Varshney, ERTS Lab, IIT Bombay
   3          * File name: velocity_control.c
   4          * Functions: left_motor_vel(unsigned int), right_motor_vel(unsigned int), pca_init(), forward()
   5          * Global variable: LF, LB, RF, RB
   6          * This experiment demonstrates simple velocity control operation using PWM.
   7          * Concepts covered: PWM Technique 
   8            
   9           Note: 
  10           1. Make sure that in the configuration options following settings are 
  11           done for proper operation of the code
  12            Microcontroller: P89V51RD2
  13           Frequency: 11.0592 MHz                                                            
  14          2.  Coding Standards followed(For further reference on Coding Standards go to portal link).
  15          *********************************************************************************/
  16          #include<intrins.h>
  17          #include "p89v51rx2.h"
  18          sbit LB=P1^0; // Left Back
  19          sbit LF=P1^1; // Left Forward
  20          sbit RF=P1^2; // Right Forward
  21          sbit RB=P3^4; // Right Back
  22          /**************************************************************************************************
  23          Function name - left_motor_vel
  24          * Input - compare velocity in hexadecimal
  25          * Output - none
  26          * Logic - changes contents of the capture register in order to change velocity
  27          *          ,set left motor with velocity vel(compare value)
  28          * Note - 0x00 will give full (100% duty cycle) velocity, while 0xFF will give zero (0% duty cycle)
  29          *        velocity. Any value in between 0x00 and 0xFF will give intermediate velocity.
  30          ****************************************************************************************************/
  31          void left_motor_vel(unsigned int vel)
  32          {
  33   1              CCAP0H=vel;
  34   1      }
  35          /**************************************************************************************************
  36          *Function name - right_motor_vel
  37          * Input - compare velocity in hexadecimal
  38          * Output - none
  39          * Logic - changes contents of the capture register in order to change velocity
  40          *          ,set right motor with velocity vel(compare value)
  41          * Note - 0x00 will give full (100% duty cycle) velocity, while 0xFF will give zero (0% duty cycle)
  42          *        velocity. Any value in between 0x00 and 0xFF will give intermediate velocity.
  43          ****************************************************************************************************/
  44          void right_motor_vel(unsigned int vel)
  45          {
  46   1              CCAP1H=vel;
  47   1      }
  48          /*Function name - pca_init
  49          * Input - none
  50          * Output - none
  51          * Logic - initialise programmable counter array to generate pwm signal */
  52          void pca_init(void)
  53          {
  54   1      //80 sets PCA counter to run at Fosc/6
  55   1      CMOD=0x80;
C51 COMPILER V9.01   VELOCITY_CONTROL                                                      06/11/2015 12:59:22 PAGE 2   

  56   1      //start PCA counter
  57   1      CCON=0x40;
  58   1      //Left motor duty cycle
  59   1      CCAP0L=0x00;
  60   1      CCAP0H=0xFF;
  61   1      //Right motor duty cycle
  62   1      CCAP1L=0x00;
  63   1      CCAP1H=0xFF;
  64   1      //enable PWM and ECOM bits for left motor
  65   1      CCAPM0=0x42;
  66   1      //enable PWM and ECOM bits for right motor
  67   1      CCAPM1=0x42;
  68   1      }
  69          /* Function name - forward
  70          * Input - none 
  71          * Outut - moves the robot in forward direction
  72          * Logic - set appropriate bits high to move forward as per the logic table
  73          */
  74          void forward()
  75          {
  76   1              LF=1;
  77   1              RF=1;
  78   1              LB=0;
  79   1              RB=0;
  80   1      }
  81          /*
  82          * Function Name: main
  83          * Input: None
  84          * Output: int to inform the caller that the program exited correctly or
  85          * incorrectly (C code standard)
  86          * Logic: generates pwm signal by calling above defined functions and setting the desired velocity
  87          * Example Call: Called automatically by the Operating System
  88          *
  89          */
  90          void main()
  91          {
  92   1              pca_init();
  93   1      /*set the motor velocities over here. Use only values
  94   1      in the range 0x00 – 0xFF */
  95   1              left_motor_vel(0x0F);
  96   1              right_motor_vel(0x0F);
  97   1              forward();
  98   1              while(1);
  99   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     57    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
